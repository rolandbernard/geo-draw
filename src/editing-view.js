
import { css, html, LitElement } from 'lit-element'

import './map-renderer';
import './map-data-input';
import Icon from './icons/logo.svg';

class EditingView extends LitElement {

    static get properties() {
        return {
            data: {attribute: false},
        };
    }

    static get styles() {
        return css`
            header {
                font-family: Roboto, sans-serif;
                font-size: 2rem;
                background: var(--background-dark);
                color: white;
                padding: 0.5rem;
                font-weight: 500;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                height: 2.75rem;
                box-shadow: var(--shadow-large);
                flex: 0 0 auto;
                z-index: 100;
            }
            header img {
                width: 2rem;
                height: 2rem;
                pointer-events: none;
            }
            div.editing-view-root {
                height: 100%;
                width: 100%;
                display: flex;
                flex-flow: column;
            }
            div.content-root {
                display: flex;
                flex: 1 1 100%;
                flex-flow: row nowrap;
                overflow: hidden;
            }
            @media (max-aspect-ratio: 1) {
                div.content-root {
                    flex-flow: column;
                }
            }
            div.editing {
                flex: 1 1 60%;
                min-height: 60%;
                min-width: 60%;
            }
            div.renderer {
                flex: 1 1 40%;
                min-height: 40%;
                min-width: 40%;
            }
            div.renderer {
                box-shadow: var(--shadow-large);
            }
            :host {
                height: 100%;
                width: 100%;
                display: block;
            }
        `;
    }

    fetchData() {
        const path = window.location.hash || '#/';
        const data_match = path.match(new RegExp('#/?(edit(/(.*))?)?'));
        if(data_match) {
            const data = data_match?.[3];
            if(!data) {
                // this.data = {
                //     // id: this.data_id++,
                //     // title: '',
                //     // defcolor: '#f0ffff',
                //     // columns: [],
                //     // color_using: [],
                //     // colors: [],
                //     // locations: [],
                //     // data: [],
                // };
                this.data = {id: this.data_id++, "title":"Coronavirus in SÃ¼dtirol - 31.10.2020","defcolor":"#f0ffff","columns":["Einwohner","Covid-19 Infektionen","Anzahl Genesener","Anzahl Verstorbener","Aktiv infizierte","% aktiv Infizierte"],"colors":["#ff0000"],"color_using":[5],"locations":["-47255","-47338","-47122","-47284","-47075","-47247","-47139","-47266","-47207","-47173","-47337","-47300","-47317","-47272","-47252","-47145","-47278","-47203","-47298","-47322","-47330","-47331","-47260","-47290","-47325","-47318","-47295","-47309","-47251","-47121","-47212","-47269","-47234","-47324","-47292","-47305","-47090","-47074","-47258","-47275","-47268","-47262","-47206","-47187","-47306","-47302","-47072","-47291","-47214","-47283","-47263","-47089","-47315","-47323","-47332","-47245","-47271","-47314","-47080","-47313","-47311","-47297","-47328","-47326","-47141","-47336","-47296","-47280","-47301","-47339","-47208","-47320","-47329","-47308","-47233","-47321","-47045","-47335","-47282","-47303","-47270","-47294","-47299","-47286","-47244","-47310","-47316","-47319","-47276","-47246","-47265","-47334","-47231","-47279","-47333","-47237","-47218","-47304","-47254","-47285","-47119","-47102","-47288","-47213","-47241","-47307","-47287","-47277","-47327","-47232","-47281","-47274","-47312","-47164","-47289","-47242"],"data":[[3471,45,35,3,7,0.20167098818784213],[6015,54,13,2,39,0.6483790523690772],[1656,19,10,0,9,0.5434782608695652],[5025,31,14,0,17,0.3383084577114428],[395,5,4,0,1,0.25316455696202533],[1038,8,6,0,2,0.1926782273603083],[3875,69,31,10,28,0.7225806451612903],[1754,13,6,0,7,0.3990877993158495],[107407,2198,633,73,1492,1.3891087173089278],[2783,47,21,1,25,0.8983111749910169],[2252,24,14,1,9,0.3996447602131439],[22572,283,127,8,148,0.6556796030480241],[16774,262,103,15,144,0.8584714439012758],[1903,23,11,0,12,0.6305832895428272],[1376,28,20,1,7,0.5087209302325582],[3977,16,8,1,7,0.17601206939904449],[3118,25,14,2,9,0.28864656831302116],[14932,277,149,25,103,0.689793731583177],[2988,38,11,0,27,0.9036144578313252],[1005,18,12,0,6,0.5970149253731344],[2667,67,10,2,55,2.0622422197225347],[3298,38,10,0,28,0.8489993935718617],[1751,20,4,0,16,0.9137635636778983],[905,5,0,0,5,0.5524861878453038],[2386,8,1,1,6,0.2514668901927913],[2325,23,12,2,9,0.3870967741935484],[780,7,6,0,1,0.1282051282051282],[3349,54,24,0,30,0.8957897879964168],[3074,35,19,1,15,0.48796356538711777],[8085,73,16,1,56,0.6926406926406926],[3421,70,22,2,46,1.3446360713241743],[2286,7,3,0,4,0.17497812773403326],[6881,95,65,19,11,0.15986048539456474],[2927,36,15,0,21,0.717458148274684],[5219,55,15,2,38,0.7281088331097912],[386,0,0,0,0,0],[2219,11,7,0,4,0.18026137899954936],[653,12,10,0,2,0.3062787136294028],[4094,31,6,0,25,0.6106497313141181],[2746,27,18,2,7,0.25491624180626365],[12467,97,43,6,48,0.385016443410604],[5198,21,5,0,16,0.30781069642170067],[338,1,1,0,0,0],[18029,513,132,19,362,2.0078761994564314],[1555,13,2,0,11,0.707395498392283],[5287,50,4,0,46,0.8700586343862303],[1281,0,0,0,0,0],[2814,10,6,0,4,0.14214641080312723],[829,8,4,0,4,0.48250904704463204],[41170,484,181,16,287,0.6971095457857663],[1694,22,5,0,17,1.0035419126328218],[1714,33,13,7,13,0.7584597432905484],[2066,18,14,1,3,0.14520813165537272],[3161,16,7,0,9,0.2847200253084467],[1421,8,4,0,4,0.28149190710767064],[1979,29,7,2,20,1.010611419909045],[5889,21,7,0,14,0.23773136355917812],[3245,23,14,1,8,0.2465331278890601],[5463,92,27,5,60,1.098297638660077],[1602,51,30,2,19,1.1860174781523096],[3170,39,10,0,29,0.914826498422713],[3815,14,4,0,10,0.2621231979030144],[1598,15,4,1,10,0.6257822277847309],[2860,41,14,0,27,0.9440559440559441],[1050,20,8,0,12,1.1428571428571428],[3090,66,23,2,41,1.3268608414239482],[737,7,1,0,6,0.8141112618724559],[3646,32,9,0,23,0.6308283049917718],[654,21,11,1,9,1.3761467889908259],[545,7,4,1,2,0.3669724770642202],[256,0,0,0,0,0],[2911,44,3,0,41,1.4084507042253522],[4538,115,27,0,88,1.9391802556192155],[1394,10,5,1,4,0.2869440459110474],[7966,47,25,2,20,0.25106703489831783],[1262,7,6,0,1,0.07923930269413629],[3807,54,28,0,26,0.6829524560021014],[5517,56,10,2,44,0.7975348921515315],[7160,80,5,2,73,1.0195530726256983],[2916,12,3,0,9,0.30864197530864196],[6242,32,6,1,25,0.40051265619993587],[1839,13,1,0,12,0.6525285481239804],[1245,3,0,0,3,0.24096385542168677],[1879,159,22,2,135,7.184672698243746],[2015,30,25,2,3,0.1488833746898263],[3569,48,32,7,9,0.2521714766040908],[3879,49,18,1,30,0.7733952049497294],[3244,20,8,2,10,0.3082614056720099],[1754,17,8,0,9,0.5131128848346637],[1541,7,3,0,4,0.25957170668397145],[4864,59,48,8,3,0.061677631578947366],[7044,95,30,5,60,0.8517887563884157],[1150,5,3,1,1,0.08695652173913043],[958,12,0,0,12,1.2526096033402923],[1759,4,2,0,2,0.11370096645821488],[4538,111,45,8,58,1.27809607756721],[1010,6,4,0,2,0.19801980198019803],[2443,12,5,0,7,0.28653295128939826],[1994,32,19,3,10,0.5015045135406219],[3346,27,13,0,14,0.41841004184100417],[3438,27,8,0,19,0.5526468877254218],[1056,10,6,1,3,0.2840909090909091],[1544,18,12,0,6,0.38860103626943004],[2911,4,2,0,2,0.06870491240123669],[760,5,4,1,0,0],[4794,42,20,2,20,0.4171881518564873],[1825,22,3,0,19,1.0410958904109588],[2571,31,17,4,10,0.38895371450797356],[3324,28,13,3,12,0.36101083032490977],[3616,26,20,0,6,0.16592920353982302],[973,1,1,0,0,0],[191,2,0,0,2,1.0471204188481675],[2919,100,13,1,86,2.9462144570058237],[1999,22,2,1,19,0.9504752376188095],[1398,24,17,0,7,0.5007153075822603],[2586,53,43,8,2,0.07733952049497293]]}
            } else {
                try {
                    this.data = JSON.parse(atob(data));
                } catch(e) {
                    this.data = {};
                }
            }
        }
    }

    constructor() {
        super();
        this.data_id = 0;
        this.fetchData();
        window.addEventListener('hashchange', this.fetchData.bind(this));
    }

    render() {
        return html`
            <div class="editing-view-root">
                <header><img src="${Icon}"/><span>Geo-Draw</span></header>
                <div class="content-root">
                    <div class="editing">
                        <map-data-input
                            .data="${this.data}"
                            @change="${(event) => this.data = event.data}"
                        ></map-data-input>
                    </div>
                    <div class="renderer">
                        <map-renderer
                            .data="${this.data}"
                        ></map-renderer>
                    </div>
                </div>
            </div>
        `;
    }

}

customElements.define('editing-view', EditingView);
